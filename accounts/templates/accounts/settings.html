{% extends "accounts/auth_base.html" %}

{% block title %}Settings{% endblock %}

{% block auth_content %}
<div class="settings-container">
    <!-- Profile Header -->
    <div class="profile-hero">
        <div class="profile-avatar">
            <span class="avatar-initials">{{ user.first_name|slice:":1"|upper }}{{ user.last_name|slice:":1"|upper }}</span>
        </div>
        <div class="profile-info">
            <h1 class="profile-name">{{ user.get_full_name|default:user.username }}</h1>
            <p class="profile-role">{{ profile.role|title|default:"Member" }}</p>
            <div class="profile-badges">
                {% if profile.phone %}
                <span class="badge-item">
                    <i class="bi bi-phone-fill"></i> {{ profile.phone }}
                    {% if profile.phone_verified %}<i class="bi bi-patch-check-fill text-success"></i>{% endif %}
                </span>
                {% endif %}
                {% if user.email %}
                <span class="badge-item">
                    <i class="bi bi-envelope-fill"></i> {{ user.email }}
                    {% if profile.email_verified %}<i class="bi bi-patch-check-fill text-success"></i>{% endif %}
                </span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Settings Sections -->
    <div class="settings-grid">
        <!-- Personal Info -->
        <div class="settings-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-person"></i></div>
                <div>
                    <h2>Personal Information</h2>
                    <p>Update your name and company details</p>
                </div>
            </div>
            <form method="post" action="{% url 'profile_edit' %}" class="settings-form">
                {% csrf_token %}
                <div class="form-row">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" name="first_name" value="{{ user.first_name }}" placeholder="Enter first name">
                    </div>
                    <div class="form-group">
                        <label>Last Name</label>
                        <input type="text" name="last_name" value="{{ user.last_name }}" placeholder="Enter last name">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Company</label>
                        <input type="text" name="company_name" value="{{ profile.company_name|default:'' }}" placeholder="Your company name">
                    </div>
                    <div class="form-group">
                        <label>Designation</label>
                        <input type="text" name="designation" value="{{ profile.designation|default:'' }}" placeholder="Your role">
                    </div>
                </div>
                <div class="form-group">
                    <label>GSTIN</label>
                    <input type="text" name="gstin" value="{{ profile.gstin|default:'' }}" placeholder="22AAAAA0000A1Z5">
                </div>
                <button type="submit" class="btn-save">
                    <i class="bi bi-check2"></i> Save Changes
                </button>
            </form>
        </div>

        <!-- Address -->
        <div class="settings-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-geo-alt"></i></div>
                <div>
                    <h2>Address</h2>
                    <p>Your business address details</p>
                </div>
            </div>
            <form method="post" action="{% url 'profile_edit' %}" class="settings-form">
                {% csrf_token %}
                <!-- Hidden fields to preserve other data -->
                <input type="hidden" name="first_name" value="{{ user.first_name }}">
                <input type="hidden" name="last_name" value="{{ user.last_name }}">
                <input type="hidden" name="company_name" value="{{ profile.company_name|default:'' }}">
                <input type="hidden" name="designation" value="{{ profile.designation|default:'' }}">
                <input type="hidden" name="gstin" value="{{ profile.gstin|default:'' }}">
                
                <div class="form-group">
                    <label>Address Line 1</label>
                    <input type="text" name="address_line1" value="{{ profile.address_line1|default:'' }}" placeholder="Street address">
                </div>
                <div class="form-group">
                    <label>Address Line 2</label>
                    <input type="text" name="address_line2" value="{{ profile.address_line2|default:'' }}" placeholder="Apartment, suite, etc.">
                </div>
                <div class="form-row three-col">
                    <div class="form-group">
                        <label>City</label>
                        <input type="text" name="city" value="{{ profile.city|default:'' }}" placeholder="City">
                    </div>
                    <div class="form-group">
                        <label>State</label>
                        <input type="text" name="state" value="{{ profile.state|default:'' }}" placeholder="State">
                    </div>
                    <div class="form-group">
                        <label>PIN Code</label>
                        <input type="text" name="pincode" value="{{ profile.pincode|default:'' }}" placeholder="123456">
                    </div>
                </div>
                <button type="submit" class="btn-save">
                    <i class="bi bi-check2"></i> Save Address
                </button>
            </form>
        </div>

        <!-- Security -->
        <div class="settings-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-shield-lock"></i></div>
                <div>
                    <h2>Security</h2>
                    <p>Manage your authentication settings</p>
                </div>
            </div>
            <div class="action-list">
                <a href="{% url 'change_phone' %}" class="action-item">
                    <div class="action-icon"><i class="bi bi-phone"></i></div>
                    <div class="action-content">
                        <h3>Change Phone Number</h3>
                        <p>Update your primary login phone</p>
                    </div>
                    <i class="bi bi-chevron-right"></i>
                </a>
                <a href="{% url 'change_email' %}" class="action-item">
                    <div class="action-icon"><i class="bi bi-envelope"></i></div>
                    <div class="action-content">
                        <h3>Change Email</h3>
                        <p>Update your email address</p>
                    </div>
                    <i class="bi bi-chevron-right"></i>
                </a>
                <a href="{% url 'active_sessions' %}" class="action-item">
                    <div class="action-icon"><i class="bi bi-laptop"></i></div>
                    <div class="action-content">
                        <h3>Active Sessions</h3>
                        <p>View and manage logged-in devices</p>
                    </div>
                    <i class="bi bi-chevron-right"></i>
                </a>
            </div>
        </div>

        <!-- Preferences -->
        <div class="settings-section">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-sliders"></i></div>
                <div>
                    <h2>Preferences</h2>
                    <p>Customize your experience</p>
                </div>
            </div>
            <div class="action-list">
                <a href="{% url 'backend_preferences' %}" class="action-item">
                    <div class="action-icon"><i class="bi bi-geo-alt"></i></div>
                    <div class="action-content">
                        <h3>SOR Rate Preferences</h3>
                        <p>Select your state's Schedule of Rates</p>
                    </div>
                    <i class="bi bi-chevron-right"></i>
                </a>
                <a href="{% url 'notification_prefs' %}" class="action-item">
                    <div class="action-icon"><i class="bi bi-bell"></i></div>
                    <div class="action-content">
                        <h3>Notifications</h3>
                        <p>Manage notification preferences</p>
                    </div>
                    <i class="bi bi-chevron-right"></i>
                </a>
            </div>
        </div>

        <!-- Data & Privacy -->
        <div class="settings-section danger-zone">
            <div class="section-header">
                <div class="section-icon"><i class="bi bi-database"></i></div>
                <div>
                    <h2>Data & Privacy</h2>
                    <p>Export or delete your data</p>
                </div>
            </div>
            <div class="action-list">
                <a href="{% url 'export_data' %}" class="action-item">
                    <div class="action-icon"><i class="bi bi-download"></i></div>
                    <div class="action-content">
                        <h3>Export Data</h3>
                        <p>Download a copy of your data</p>
                    </div>
                    <i class="bi bi-chevron-right"></i>
                </a>
                <a href="{% url 'delete_account' %}" class="action-item danger">
                    <div class="action-icon"><i class="bi bi-trash3"></i></div>
                    <div class="action-content">
                        <h3>Delete Account</h3>
                        <p>Permanently remove your account</p>
                    </div>
                    <i class="bi bi-chevron-right"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Account Info Footer -->
    <div class="account-footer">
        <p><i class="bi bi-calendar3"></i> Member since {{ user.date_joined|date:"F Y" }}</p>
        <p><i class="bi bi-clock-history"></i> Last login: {{ user.last_login|date:"d M Y, h:i A"|default:"Never" }}</p>
    </div>
</div>

<style>
:root {
    --primary: #6366f1;
    --primary-light: #818cf8;
    --primary-dark: #4f46e5;
    --success: #10b981;
    --danger: #ef4444;
    --gray-50: #f9fafb;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-300: #d1d5db;
    --gray-400: #9ca3af;
    --gray-500: #6b7280;
    --gray-600: #4b5563;
    --gray-700: #374151;
    --gray-800: #1f2937;
    --gray-900: #111827;
    --radius: 16px;
    --radius-sm: 10px;
    --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
}

.settings-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem 1rem;
}

/* Profile Hero */
.profile-hero {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    padding: 2rem;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    border-radius: var(--radius);
    margin-bottom: 2rem;
    color: white;
}

.profile-avatar {
    width: 80px;
    height: 80px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.avatar-initials {
    font-size: 1.75rem;
    font-weight: 700;
    letter-spacing: 1px;
}

.profile-name {
    font-size: 1.5rem;
    font-weight: 700;
    margin: 0 0 0.25rem;
}

.profile-role {
    opacity: 0.9;
    margin: 0 0 0.75rem;
    font-size: 0.95rem;
}

.profile-badges {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
}

.badge-item {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    background: rgba(255,255,255,0.15);
    padding: 0.35rem 0.75rem;
    border-radius: 20px;
    font-size: 0.85rem;
}

.badge-item .text-success {
    color: #4ade80 !important;
}

/* Settings Grid */
.settings-grid {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

/* Settings Section */
.settings-section {
    background: white;
    border-radius: var(--radius);
    padding: 1.5rem;
    box-shadow: var(--shadow);
    border: 1px solid var(--gray-100);
}

.section-header {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--gray-100);
}

.section-icon {
    width: 44px;
    height: 44px;
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1.2rem;
    flex-shrink: 0;
}

.section-header h2 {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--gray-800);
    margin: 0 0 0.25rem;
}

.section-header p {
    font-size: 0.875rem;
    color: var(--gray-500);
    margin: 0;
}

/* Forms */
.settings-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.form-row.three-col {
    grid-template-columns: 1fr 1fr 1fr;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
}

.form-group label {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--gray-600);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.form-group input {
    padding: 0.75rem 1rem;
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-sm);
    font-size: 0.95rem;
    transition: all 0.2s ease;
    background: var(--gray-50);
}

.form-group input:focus {
    outline: none;
    border-color: var(--primary);
    background: white;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.form-group input::placeholder {
    color: var(--gray-400);
}

.btn-save {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    font-size: 0.95rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    align-self: flex-start;
    margin-top: 0.5rem;
}

.btn-save:hover {
    background: var(--primary-dark);
    transform: translateY(-1px);
}

/* Action List */
.action-list {
    display: flex;
    flex-direction: column;
}

.action-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    margin: 0 -1.5rem;
    padding-left: 1.5rem;
    padding-right: 1.5rem;
    text-decoration: none;
    color: inherit;
    transition: all 0.2s ease;
    border-bottom: 1px solid var(--gray-100);
}

.action-item:last-child {
    border-bottom: none;
}

.action-item:hover {
    background: var(--gray-50);
}

.action-icon {
    width: 40px;
    height: 40px;
    background: var(--gray-100);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--gray-600);
    font-size: 1.1rem;
    flex-shrink: 0;
    transition: all 0.2s ease;
}

.action-item:hover .action-icon {
    background: var(--primary);
    color: white;
}

.action-content {
    flex: 1;
}

.action-content h3 {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--gray-800);
    margin: 0 0 0.2rem;
}

.action-content p {
    font-size: 0.85rem;
    color: var(--gray-500);
    margin: 0;
}

.action-item > .bi-chevron-right {
    color: var(--gray-400);
    font-size: 1rem;
}

/* Danger Zone */
.action-item.danger .action-icon {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger);
}

.action-item.danger:hover .action-icon {
    background: var(--danger);
    color: white;
}

.action-item.danger .action-content h3 {
    color: var(--danger);
}

/* Account Footer */
.account-footer {
    display: flex;
    justify-content: center;
    gap: 2rem;
    padding: 1.5rem;
    margin-top: 2rem;
    color: var(--gray-500);
    font-size: 0.85rem;
}

.account-footer p {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
}

/* Responsive */
@media (max-width: 768px) {
    .profile-hero {
        flex-direction: column;
        text-align: center;
        padding: 1.5rem;
    }
    
    .profile-badges {
        justify-content: center;
    }
    
    .form-row,
    .form-row.three-col {
        grid-template-columns: 1fr;
    }
    
    .account-footer {
        flex-direction: column;
        gap: 0.5rem;
        align-items: center;
    }
    
    .settings-section {
        padding: 1.25rem;
    }
    
    .action-item {
        margin: 0 -1.25rem;
        padding-left: 1.25rem;
        padding-right: 1.25rem;
    }
}

/* Animation */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.settings-section {
    animation: fadeIn 0.3s ease forwards;
}

.settings-section:nth-child(1) { animation-delay: 0s; }
.settings-section:nth-child(2) { animation-delay: 0.05s; }
.settings-section:nth-child(3) { animation-delay: 0.1s; }
.settings-section:nth-child(4) { animation-delay: 0.15s; }
.settings-section:nth-child(5) { animation-delay: 0.2s; }
</style>
{% endblock %}
