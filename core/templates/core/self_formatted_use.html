{% extends "core/base.html" %}

{% load static %}

{% block content %}
<style>
    .form-container {
        max-width: 600px;
        margin: 30px auto;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    h2 {
        margin-top: 0;
    }

    .form-group {
        margin: 20px 0;
    }

    .form-group input[type="file"],
    .form-group button {
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
        font-size: 14px;
    }

    .form-group button {
        background: #0d6efd;
        color: white;
        border: none;
        cursor: pointer;
    }

    .form-group button:hover {
        background: #0b5ed7;
    }

    .back-link {
        display: block;
        margin-top: 20px;
        text-align: center;
    }
</style>

<div class="form-container">
    <h2>Use Saved Format: {{ format.name }}</h2>

    <p>{{ format.description }}</p>

    <form method="POST" enctype="multipart/form-data" id="format-form">
        {% csrf_token %}

        <div class="form-group">
            <h4>Upload Source File to read from (Bill / Estimate / MB / PDF / Image)</h4>
            <p style="font-size:0.85rem; color:#666; margin-bottom:10px;">
                <i class="bi bi-magic"></i> Supports blurred/scanned documents with smart OCR
            </p>
            <input type="file" name="source_file" 
                   accept=".xlsx,.xlsm,.docx,.pdf,.jpg,.jpeg,.png,.bmp,.tiff,.tif,.gif,.webp,.txt,.csv" required>
        </div>

        <div class="form-group">
            <button type="submit" id="generate-btn">Generate Document</button>
        </div>
    </form>

    <p>
        This will use the template and custom placeholders stored for this format,
        plus all built-in placeholders (Name of work, Agreement, MB, T.P, Amount, etc.)
    </p>

    <p class="back-link"><a href="{% url 'self_formatted_form_page' %}">‚Üê Back to Self-Formatted Forms</a></p>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("format-form");
        const btn = document.getElementById("generate-btn");

        form.addEventListener("submit", function () {
            // Disable button and show feedback while the browser downloads
            btn.disabled = true;
            btn.textContent = "Generating...";
            // Re-enable after a few seconds (browser will start the download)
            setTimeout(function () {
                btn.disabled = false;
                btn.textContent = "Generate Document";
            }, 5000);
        });
    });
</script>
{% endblock %}

